<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Void Mod Training</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;600;700&family=Roboto+Mono:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* [All previous CSS remains exactly the same until the .test-page styles] */
        
        /* Test Page Styles (Discord-like) - Enhanced */
        .test-page {
            display: none;
            font-family: 'Roboto', sans-serif;
            background-color: var(--discord-bg);
            color: var(--discord-text-primary);
            height: 100vh;
            width: 100%;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            overflow: hidden;
        }
        
        .test-container {
            display: flex;
            height: 100vh;
            width: 100%;
        }
        
        /* Discord Username Modal */
        .username-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .username-modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: var(--discord-bg);
            padding: 40px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            border: 1px solid var(--discord-border);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .modal-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: white;
            text-align: center;
        }
        
        .modal-description {
            color: var(--discord-text-secondary);
            margin-bottom: 25px;
            text-align: center;
            line-height: 1.6;
        }
        
        .username-input-container {
            margin-bottom: 25px;
        }
        
        .username-label {
            display: block;
            margin-bottom: 8px;
            color: var(--discord-text-primary);
            font-weight: 500;
        }
        
        .username-input {
            width: 100%;
            padding: 14px;
            background-color: #40444b;
            border: 1px solid var(--discord-border);
            border-radius: 4px;
            color: var(--discord-text-primary);
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .username-input:focus {
            border-color: var(--discord-blue);
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        /* Enhanced Discord Sidebar */
        .discord-sidebar {
            width: 240px;
            background-color: var(--discord-sidebar);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--discord-border);
            overflow-y: auto;
        }
        
        .server-header {
            padding: 20px;
            border-bottom: 1px solid var(--discord-border);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .server-header:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .server-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #8a2be2, #4a00e0);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .server-name {
            font-weight: 700;
            font-size: 1.1rem;
            flex-grow: 1;
        }
        
        .server-dropdown {
            color: var(--discord-text-secondary);
            transition: transform 0.2s;
        }
        
        .server-dropdown.open {
            transform: rotate(180deg);
        }
        
        .server-info-panel {
            background-color: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-bottom: 1px solid var(--discord-border);
            display: none;
        }
        
        .server-info-panel.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .server-members {
            font-size: 0.9rem;
            color: var(--discord-text-secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .online-count {
            color: var(--discord-green);
            font-weight: 600;
        }
        
        .server-description {
            font-size: 0.85rem;
            line-height: 1.4;
            color: var(--discord-text-secondary);
        }
        
        /* Test Info Panel */
        .test-info {
            padding: 20px;
            border-bottom: 1px solid var(--discord-border);
        }
        
        .test-title {
            font-weight: 700;
            margin-bottom: 10px;
            color: white;
            font-size: 1.2rem;
        }
        
        .test-description {
            font-size: 0.9rem;
            color: var(--discord-text-secondary);
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .score-display {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .score-title {
            font-size: 0.9rem;
            color: var(--discord-text-secondary);
            margin-bottom: 5px;
        }
        
        .score-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
        }
        
        .score-total {
            font-size: 1rem;
            color: var(--discord-text-secondary);
        }
        
        .progress-bar-test {
            height: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-fill-test {
            height: 100%;
            background: linear-gradient(90deg, var(--discord-blue), var(--discord-green));
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
            padding: 8px 12px;
            border-radius: 4px;
            background-color: rgba(0, 0, 0, 0.2);
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--discord-green);
        }
        
        .status-text {
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        /* Channels Section */
        .channels-section {
            padding: 10px 0;
            border-bottom: 1px solid var(--discord-border);
        }
        
        .channels-header {
            padding: 0 20px 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .channels-header:hover {
            color: white;
        }
        
        .channels-title {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--discord-text-secondary);
        }
        
        .channels-dropdown {
            color: var(--discord-text-secondary);
            font-size: 0.8rem;
            transition: transform 0.2s;
        }
        
        .channels-dropdown.open {
            transform: rotate(90deg);
        }
        
        .channels-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .channel-item {
            padding: 8px 10px 8px 30px;
            border-radius: 4px;
            margin: 2px 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background-color 0.2s, color 0.2s;
            font-size: 0.95rem;
        }
        
        .channel-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
        }
        
        .channel-item.active {
            background-color: rgba(88, 101, 242, 0.2);
            color: white;
        }
        
        .channel-item.unread .channel-name::after {
            content: '•';
            color: var(--discord-blue);
            font-weight: bold;
            margin-left: 5px;
        }
        
        .channel-icon {
            width: 20px;
            text-align: center;
            color: var(--discord-text-secondary);
        }
        
        .channel-name {
            flex-grow: 1;
        }
        
        .channel-notification {
            background-color: var(--discord-red);
            color: white;
            font-size: 0.7rem;
            padding: 1px 5px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
            font-weight: 600;
        }
        
        /* User Profile Section */
        .user-profile {
            padding: 15px;
            background-color: #292b2f;
            display: flex;
            align-items: center;
            gap: 10px;
            border-top: 1px solid var(--discord-border);
            margin-top: auto;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .user-profile:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8a2be2, #4a00e0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            color: white;
            position: relative;
        }
        
        .user-status {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--discord-green);
            border: 2px solid #292b2f;
        }
        
        .user-info {
            flex-grow: 1;
        }
        
        .username-display {
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .user-tag {
            font-size: 0.8rem;
            color: var(--discord-text-secondary);
        }
        
        .user-controls {
            color: var(--discord-text-secondary);
        }
        
        /* User Profile Modal */
        .user-modal {
            display: none;
            position: absolute;
            bottom: 80px;
            left: 20px;
            background-color: var(--discord-sidebar);
            border-radius: 8px;
            width: 250px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--discord-border);
            z-index: 1001;
            overflow: hidden;
        }
        
        .user-modal.active {
            display: block;
            animation: slideUp 0.2s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-modal-header {
            padding: 20px;
            background: linear-gradient(135deg, #8a2be2, #4a00e0);
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-modal-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .user-modal-info {
            flex-grow: 1;
        }
        
        .user-modal-name {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .user-modal-tag {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .user-modal-body {
            padding: 20px;
        }
        
        .user-modal-section {
            margin-bottom: 20px;
        }
        
        .user-modal-title {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--discord-text-secondary);
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }
        
        .user-modal-roles {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .role-tag {
            background-color: rgba(88, 101, 242, 0.2);
            color: var(--discord-blue);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .user-modal-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--discord-text-secondary);
        }
        
        /* Discord Chat Area */
        .discord-chat-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--discord-chat-bg);
        }
        
        .chat-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--discord-border);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }
        
        .chat-channel-name {
            font-weight: 700;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chat-channel-topic {
            font-size: 0.9rem;
            color: var(--discord-text-secondary);
            margin-top: 3px;
        }
        
        .chat-channel-members {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .members-count {
            font-size: 0.9rem;
            color: var(--discord-text-secondary);
        }
        
        .members-list {
            display: flex;
        }
        
        .member-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-left: -5px;
            border: 2px solid var(--discord-chat-bg);
            background-color: #5865f2;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            color: white;
        }
        
        .chat-controls {
            display: flex;
            gap: 10px;
        }
        
        .chat-control-btn {
            background: none;
            border: none;
            color: var(--discord-text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .chat-control-btn:hover {
            color: white;
        }
        
        .messages-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .message {
            display: flex;
            margin-bottom: 20px;
            animation: messageAppear 0.3s ease;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .message-avatar:hover {
            transform: scale(1.05);
        }
        
        .message-content {
            flex-grow: 1;
            max-width: calc(100% - 55px);
        }
        
        .message-header {
            display: flex;
            align-items: baseline;
            margin-bottom: 5px;
            flex-wrap: wrap;
        }
        
        .message-username {
            font-weight: 600;
            font-size: 1rem;
            margin-right: 8px;
            cursor: pointer;
        }
        
        .message-username:hover {
            text-decoration: underline;
        }
        
        .message-timestamp {
            font-size: 0.75rem;
            color: var(--discord-text-secondary);
        }
        
        .message-text {
            font-size: 0.95rem;
            line-height: 1.4;
            word-wrap: break-word;
        }
        
        .message-bot-tag {
            background-color: #5865f2;
            color: white;
            font-size: 0.7rem;
            padding: 1px 4px;
            border-radius: 3px;
            margin-left: 6px;
            vertical-align: middle;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            opacity: 0.7;
        }
        
        .typing-dots {
            display: flex;
            align-items: center;
            gap: 3px;
            margin-left: 15px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: var(--discord-text-secondary);
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        .message-input-area {
            padding: 20px;
            background-color: var(--discord-message-bg);
            border-top: 1px solid var(--discord-border);
        }
        
        .message-input-container {
            background-color: #40444b;
            border-radius: 8px;
            display: flex;
            padding: 10px;
        }
        
        .message-input {
            flex-grow: 1;
            background: transparent;
            border: none;
            color: var(--discord-text-primary);
            font-size: 0.95rem;
            padding: 5px 10px;
            outline: none;
            font-family: 'Roboto', sans-serif;
            resize: none;
            max-height: 100px;
            min-height: 20px;
        }
        
        .message-input::placeholder {
            color: var(--discord-text-secondary);
        }
        
        .send-button {
            background-color: var(--discord-blue);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .send-button:hover {
            background-color: #4752c4;
        }
        
        .send-button:disabled {
            background-color: #4a4d57;
            cursor: not-allowed;
        }
        
        /* Correct/Incorrect Message Styles */
        .message.correct .message-text {
            border-left: 3px solid var(--discord-green);
            padding-left: 10px;
        }
        
        .message.incorrect .message-text {
            border-left: 3px solid var(--discord-red);
            padding-left: 10px;
        }
        
        .feedback-badge {
            display: inline-block;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 8px;
            vertical-align: middle;
            font-weight: 600;
        }
        
        .correct-badge {
            background-color: rgba(59, 165, 92, 0.2);
            color: var(--discord-green);
        }
        
        .incorrect-badge {
            background-color: rgba(237, 66, 69, 0.2);
            color: var(--discord-red);
        }
        
        /* Test Complete Screen */
        .test-complete-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
            padding: 40px;
            text-align: center;
            background-color: var(--discord-bg);
        }
        
        .test-complete-screen.active {
            display: flex;
        }
        
        .test-result-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }
        
        .test-result-pass {
            color: var(--discord-green);
        }
        
        .test-result-fail {
            color: var(--discord-red);
        }
        
        .test-result-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: white;
        }
        
        .test-result-score {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--discord-text-secondary);
        }
        
        .test-result-message {
            max-width: 600px;
            margin-bottom: 30px;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        .submission-status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            background-color: rgba(88, 101, 242, 0.1);
            border: 1px solid var(--discord-blue);
            max-width: 500px;
            width: 100%;
        }
        
        .submission-success {
            background-color: rgba(59, 165, 92, 0.1);
            border: 1px solid var(--discord-green);
        }
        
        .submission-error {
            background-color: rgba(237, 66, 69, 0.1);
            border: 1px solid var(--discord-red);
        }
        
        .test-result-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .test-result-button {
            padding: 12px 30px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .test-btn-primary {
            background-color: var(--discord-blue);
            color: white;
        }
        
        .test-btn-primary:hover {
            background-color: #4752c4;
        }
        
        .test-btn-secondary {
            background-color: #4f545c;
            color: white;
        }
        
        .test-btn-secondary:hover {
            background-color: #5d6269;
        }
        
        /* Back button for test page */
        .back-to-training {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1001;
            font-weight: 600;
        }
        
        .back-to-training:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        /* Hidden form for email submission */
        #resultsForm {
            display: none;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }
        
        .footer-credit {
            margin-top: 10px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.4);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.2rem;
            }
            
            .section-title {
                font-size: 1.7rem;
            }
            
            .ticket-types, .roster-categories {
                grid-template-columns: 1fr;
            }
            
            .progress-container {
                flex-direction: column;
                gap: 20px;
            }
            
            .progress-bar {
                width: 100%;
                margin: 20px 0;
            }
            
            .quiz-buttons, .completion-buttons, .modal-buttons, .test-result-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn, .test-result-button {
                width: 100%;
            }
            
            /* Test page responsive */
            .test-container {
                flex-direction: column;
            }
            
            .discord-sidebar {
                width: 100%;
                height: auto;
                max-height: 200px;
                overflow-y: auto;
            }
            
            .test-info {
                display: none;
            }
            
            .user-modal {
                left: 50%;
                transform: translateX(-50%);
                bottom: 100px;
            }
        }
    </style>
</head>
<body>
    <!-- [All previous HTML remains exactly the same until the test page section] -->
    
    <!-- Test Page (Hidden by default) -->
    <div class="test-page" id="testPage">
        <button class="back-to-training" id="backToTraining">
            <i class="fas fa-arrow-left"></i> Back to Training
        </button>
        
        <div class="test-container">
            <!-- Enhanced Discord Sidebar -->
            <div class="discord-sidebar" id="discordSidebar">
                <div class="server-header" id="serverHeader">
                    <div class="server-icon">V</div>
                    <div class="server-name">Void Esports</div>
                    <div class="server-dropdown" id="serverDropdown">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                
                <!-- Server Info Panel -->
                <div class="server-info-panel" id="serverInfoPanel">
                    <div class="server-members">
                        <i class="fas fa-user-friends"></i>
                        <span class="online-count">247</span>
                        <span>Online</span>
                        <span>•</span>
                        <span>1,284 Members</span>
                    </div>
                    <div class="server-description">
                        Competitive Fortnite organization since 2019. Home to pro players, content creators, and competitive grinders.
                    </div>
                </div>
                
                <!-- Test Info Panel -->
                <div class="test-info">
                    <div class="test-title">Mod Certification Test</div>
                    <div class="test-description">Handle a simulated conversation with a user applying to join Void. Respond as if you're a real mod handling a ticket.</div>
                    
                    <div class="score-display">
                        <div class="score-title">SCORE</div>
                        <div>
                            <span class="score-value" id="scoreValue">0</span>
                            <span class="score-total">/ 8</span>
                        </div>
                        <div class="progress-bar-test">
                            <div class="progress-fill-test" id="progressFillTest"></div>
                        </div>
                    </div>
                    
                    <div class="status-indicator">
                        <div class="status-dot" id="statusDot"></div>
                        <div class="status-text" id="statusText">Test In Progress</div>
                    </div>
                </div>
                
                <!-- Channels Section -->
                <div class="channels-section">
                    <div class="channels-header" id="channelsHeader">
                        <div class="channels-title">Text Channels</div>
                        <div class="channels-dropdown" id="channelsDropdown">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                    
                    <div class="channels-list" id="channelsList">
                        <!-- Channels will be dynamically added here -->
                    </div>
                </div>
                
                <!-- Voice Channels Section -->
                <div class="channels-section">
                    <div class="channels-header" id="voiceChannelsHeader">
                        <div class="channels-title">Voice Channels</div>
                        <div class="channels-dropdown" id="voiceChannelsDropdown">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                    
                    <div class="channels-list" id="voiceChannelsList">
                        <!-- Voice channels will be dynamically added here -->
                    </div>
                </div>
                
                <!-- User Profile -->
                <div class="user-profile" id="userProfile">
                    <div class="user-avatar" id="userAvatar">
                        <div class="user-status"></div>
                    </div>
                    <div class="user-info">
                        <div class="username-display" id="usernameDisplay">You</div>
                        <div class="user-tag">Trainee Mod</div>
                    </div>
                    <div class="user-controls">
                        <i class="fas fa-cog"></i>
                    </div>
                </div>
                
                <!-- User Profile Modal -->
                <div class="user-modal" id="userModal">
                    <div class="user-modal-header">
                        <div class="user-modal-avatar" id="userModalAvatar">Y</div>
                        <div class="user-modal-info">
                            <div class="user-modal-name" id="userModalName">You</div>
                            <div class="user-modal-tag" id="userModalTag">Trainee Mod</div>
                        </div>
                    </div>
                    <div class="user-modal-body">
                        <div class="user-modal-section">
                            <div class="user-modal-title">Roles</div>
                            <div class="user-modal-roles">
                                <div class="role-tag">Trainee Mod</div>
                                <div class="role-tag">Roster Team</div>
                                <div class="role-tag">Academy</div>
                            </div>
                        </div>
                        <div class="user-modal-section">
                            <div class="user-modal-title">Stats</div>
                            <div class="user-modal-stats">
                                <div class="stat-item">
                                    <div class="stat-value" id="statTickets">0</div>
                                    <div class="stat-label">Tickets Handled</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="statScore">0%</div>
                                    <div class="stat-label">Test Score</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">7</div>
                                    <div class="stat-label">Days in Server</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">24</div>
                                    <div class="stat-label">Hours Active</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Discord Chat Area -->
            <div class="discord-chat-area" id="chatArea">
                <div class="chat-header">
                    <div>
                        <div class="chat-channel-name">
                            <i class="fas fa-hashtag"></i>
                            <span id="activeChannelName">training-test</span>
                        </div>
                        <div class="chat-channel-topic" id="channelTopic">Simulated mod test - Handle this conversation as if it were a real ticket</div>
                    </div>
                    <div class="chat-channel-members">
                        <div class="members-count">
                            <span id="onlineCount">3</span> online
                        </div>
                        <div class="members-list">
                            <div class="member-avatar" title="Void Bot">VB</div>
                            <div class="member-avatar" title="Nicks Cold">NC</div>
                            <div class="member-avatar" title="You">Y</div>
                        </div>
                    </div>
                    <div class="chat-controls">
                        <button class="chat-control-btn" id="pinMessagesBtn" title="Pinned Messages">
                            <i class="fas fa-thumbtack"></i>
                        </button>
                        <button class="chat-control-btn" id="membersListBtn" title="Member List">
                            <i class="fas fa-user-friends"></i>
                        </button>
                        <button class="chat-control-btn" id="searchBtn" title="Search">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                
                <div class="messages-container" id="messagesContainer">
                    <!-- Test instructions -->
                    <div class="message">
                        <div class="message-avatar" style="background-color: #5865f2;">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-username">Void Bot</div>
                                <span class="message-bot-tag">BOT</span>
                                <div class="message-timestamp">Today at 12:00 PM</div>
                            </div>
                            <div class="message-text">
                                Welcome to the Void Mod Certification Test! A simulated user named <strong>Nicks Cold</strong> will message you with various requests. Respond as if you're handling a real ticket. Your responses will be evaluated for correctness.
                            </div>
                        </div>
                    </div>
                    
                    <div class="message">
                        <div class="message-avatar" style="background-color: #5865f2;">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-username">Void Bot</div>
                                <span class="message-bot-tag">BOT</span>
                                <div class="message-timestamp">Today at 12:00 PM</div>
                            </div>
                            <div class="message-text">
                                <strong>Test Starting...</strong> The conversation will begin shortly. Type your responses in the message box below and click Send.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Messages will be added here by JavaScript -->
                </div>
                
                <!-- Typing indicator (shown when bot is "typing") -->
                <div class="typing-indicator" id="typingIndicator" style="display: none;">
                    <div class="message-avatar" style="background-color: #ed4245;">NC</div>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
                
                <div class="message-input-area">
                    <div class="message-input-container">
                        <textarea class="message-input" id="messageInput" placeholder="Message #training-test" rows="1"></textarea>
                        <button class="send-button" id="sendButton">
                            <i class="fas fa-paper-plane"></i> Send
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Test Complete Screen -->
        <div class="test-complete-screen" id="testCompleteScreen">
            <div class="test-result-icon" id="testResultIcon">
                <i class="fas fa-trophy"></i>
            </div>
            <div class="test-result-title" id="testResultTitle">Test Complete!</div>
            <div class="test-result-score" id="testResultScore">Score: 0/8</div>
            <div class="test-result-message" id="testResultMessage">
                Your responses have been evaluated. Check your score above.
            </div>
            
            <div class="submission-status" id="submissionStatus">
                <i class="fas fa-spinner fa-spin"></i> Submitting your results to Void Esports staff...
            </div>
            
            <div class="test-result-buttons">
                <button class="test-result-button test-btn-primary" id="testReviewTestBtn">
                    <i class="fas fa-redo"></i> Retake Test
                </button>
                <button class="test-result-button test-btn-secondary" id="testBackToTrainingBtn">
                    <i class="fas fa-arrow-left"></i> Back to Training
                </button>
            </div>
        </div>
    </div>
    
    <!-- Hidden form for email submission -->
    <form id="resultsForm" action="https://formsubmit.co/hunterahead71@gmail.com" method="POST">
        <input type="hidden" name="_subject" value="Void Mod Certification Test Results">
        <input type="hidden" name="_template" value="table">
        <input type="hidden" name="_captcha" value="false">
        <input type="hidden" name="_next" value="">
        <input type="text" name="_honey" style="display:none">
        
        <input type="hidden" name="discord_username" id="formDiscordUsername">
        <input type="hidden" name="test_date" id="formTestDate">
        <input type="hidden" name="final_score" id="formFinalScore">
        <input type="hidden" name="pass_fail" id="formPassFail">
        <input type="hidden" name="question_breakdown" id="formQuestionBreakdown">
        <input type="hidden" name="total_questions" id="formTotalQuestions">
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ==========================================
            // TRAINING QUIZ LOGIC (Remains the same)
            // ==========================================
            
            // [All previous training quiz logic remains exactly the same]
            
            // ==========================================
            // ENHANCED TEST PAGE LOGIC WITH DYNAMIC DISCORD
            // ==========================================
            
            // Enhanced test configuration with comprehensive keyword matching
            const testQuestions = [
                {
                    id: 1,
                    userMessage: "Hi i want to join void",
                    correctKeywords: [
                        "age", "how old", "years old", "old are you", "birthday",
                        "roster", "channel", "requirement", "fit", "category", "join",
                        "check", "read", "how-to-join", "information", "details",
                        "what role", "which role", "position", "apply", "application"
                    ],
                    requiredMatches: 2,
                    user: "Nicks Cold",
                    avatarColor: "#ed4245",
                    explanation: "Your response should ask for their age and direct them to #how-to-join-roster to read requirements."
                },
                {
                    id: 2,
                    userMessage: "i want to join as a pro",
                    correctKeywords: [
                        "tracker", "fortnite tracker", "stats", "ranking", "pr",
                        "send", "share", "provide", "show", "give",
                        "trapped", "cheif", "higher-up", "staff", "ping",
                        "earnings", "power ranking", "tournament", "competitive",
                        "wait", "hold on", "moment", "please wait"
                    ],
                    requiredMatches: 2,
                    user: "Nicks Cold",
                    avatarColor: "#ed4245",
                    explanation: "Ask for their Fortnite tracker and ping @trapped or @cheif for pro applications."
                },
                {
                    id: 3,
                    userMessage: "i want to join as creative roster",
                    correctKeywords: [
                        "clip", "video", "footage", "gameplay", "freebuilding",
                        "send", "share", "provide", "show", "upload",
                        "creativedepartment", "creative team", "creative staff",
                        "ping", "mention", "notify", "alert",
                        "wait", "hold on", "moment", "please wait",
                        "at least 2", "two clips", "multiple clips"
                    ],
                    requiredMatches: 2,
                    user: "Nicks Cold",
                    avatarColor: "#ed4245",
                    explanation: "Ask for at least 2 clips of freebuilding and ping @creativedepartment."
                },
                {
                    id: 4,
                    userMessage: "i want to join as academy player",
                    correctKeywords: [
                        "tracker", "fortnite tracker", "stats", "ranking", "pr",
                        "send", "share", "provide", "show", "give",
                        "verify", "check", "confirm", "validate",
                        "username", "name change", "add void", "team.void",
                        "proof", "evidence", "screenshot", "photo"
                    ],
                    requiredMatches: 2,
                    user: "Nicks Cold",
                    avatarColor: "#ed4245",
                    explanation: "Ask for their Fortnite tracker, verify PR meets requirements, ask for username change and team.void proof."
                },
                {
                    id: 5,
                    userMessage: "im 12 years old is that okay?",
                    correctKeywords: [
                        "cheif", "trapped", "higher-up", "staff", "admin",
                        "ping", "mention", "notify", "alert", "contact",
                        "underage", "minimum age", "13", "age requirement",
                        "not allowed", "against rules", "policy", "guidelines",
                        "ban", "remove", "cannot join", "not eligible"
                    ],
                    requiredMatches: 2,
                    user: "Nicks Cold",
                    avatarColor: "#ed4245",
                    explanation: "Underage users (under 13) should be pinged to @cheif or informed about age requirements."
                },
                {
                    id: 6,
                    userMessage: "i want to join as void grinder",
                    correctKeywords: [
                        "username", "discord name", "fortnite name", "name change",
                        "add void", "include void", "void prefix", "team void",
                        "team.void", "support code", "creator code", "item shop",
                        "proof", "screenshot", "photo", "evidence", "show me",
                        "change", "modify", "update", "adjust"
                    ],
                    requiredMatches: 2,
                    user: "Nicks Cold",
                    avatarColor: "#ed4245",
                    explanation: "Ask them to change Discord/Fortnite username to include 'Void' and use team.void with proof."
                },
                {
                    id: 7,
                    userMessage: "i will nuke this server",
                    correctKeywords: [
                        "cheif", "trapped", "higher-up", "staff", "admin",
                        "ping", "mention", "notify", "alert", "contact",
                        "threat", "dangerous", "against rules", "violation",
                        "ban", "remove", "kick", "punish", "disciplinary",
                        "immediately", "right away", "asap", "urgent",
                        "security", "safety", "report", "document"
                    ],
                    requiredMatches: 2,
                    user: "Nicks Cold",
                    avatarColor: "#ed4245",
                    explanation: "Threats should result in immediate ping to @cheif and mention of potential ban."
                },
                {
                    id: 8,
                    userMessage: "i wanna join as a content creator",
                    correctKeywords: [
                        "social", "social media", "links", "profiles", "accounts",
                        "send", "share", "provide", "show", "give",
                        "contentdep", "content team", "content staff", "creator team",
                        "ping", "mention", "notify", "alert",
                        "wait", "hold on", "moment", "please wait",
                        "followers", "subscribers", "viewers", "audience"
                    ],
                    requiredMatches: 2,
                    user: "Nicks Cold",
                    avatarColor: "#ed4245",
                    explanation: "Ask for social media links and ping @contentdep for content creator applications."
                }
            ];
            
            // Enhanced channels data
            const textChannels = [
                { id: 1, name: "training-test", icon: "fas fa-hashtag", topic: "Simulated mod test", unread: false, notifications: 0 },
                { id: 2, name: "how-to-join-roster", icon: "fas fa-hashtag", topic: "Information about joining Void", unread: true, notifications: 3 },
                { id: 3, name: "general", icon: "fas fa-hashtag", topic: "General discussion", unread: true, notifications: 12 },
                { id: 4, name: "announcements", icon: "fas fa-bullhorn", topic: "Server announcements", unread: false, notifications: 0 },
                { id: 5, name: "mod-chat", icon: "fas fa-shield-alt", topic: "Moderator discussions", unread: true, notifications: 5 },
                { id: 6, name: "staff-announcements", icon: "fas fa-bell", topic: "Staff announcements", unread: false, notifications: 0 },
                { id: 7, name: "roster-applications", icon: "fas fa-user-plus", topic: "Roster applications channel", unread: true, notifications: 7 },
                { id: 8, name: "help-desk", icon: "fas fa-question-circle", topic: "Get help from staff", unread: false, notifications: 2 }
            ];
            
            const voiceChannels = [
                { id: 1, name: "General Voice", icon: "fas fa-volume-up", users: 8, topic: "Casual chatting" },
                { id: 2, name: "Competitive Scrims", icon: "fas fa-gamepad", users: 12, topic: "Practice and scrims" },
                { id: 3, name: "Music Lounge", icon: "fas fa-music", users: 5, topic: "Chill with music" },
                { id: 4, name: "Mod Meeting", icon: "fas fa-users", users: 3, topic: "Staff meetings" },
                { id: 5, name: "Tournament VC", icon: "fas fa-trophy", users: 0, topic: "Tournament coordination" }
            ];
            
            // Test state
            let testCurrentQuestion = 0;
            let testScore = 0;
            let testActive = false;
            const testTotalQuestions = testQuestions.length;
            let userDiscordUsername = '';
            let userAnswers = [];
            let correctAnswers = [];
            
            // DOM elements for test page
            const backToTrainingBtn = document.getElementById('backToTraining');
            const testMessagesContainer = document.getElementById('messagesContainer');
            const testMessageInput = document.getElementById('messageInput');
            const testSendButton = document.getElementById('sendButton');
            const testTypingIndicator = document.getElementById('typingIndicator');
            const testChatArea = document.getElementById('chatArea');
            const testCompleteScreen = document.getElementById('testCompleteScreen');
            const testScoreValue = document.getElementById('scoreValue');
            const testStatusDot = document.getElementById('statusDot');
            const testStatusText = document.getElementById('statusText');
            const testResultTitle = document.getElementById('testResultTitle');
            const testResultScore = document.getElementById('testResultScore');
            const testResultMessage = document.getElementById('testResultMessage');
            const testResultIcon = document.getElementById('testResultIcon');
            const testReviewTestBtn = document.getElementById('testReviewTestBtn');
            const testBackToTrainingBtn = document.getElementById('testBackToTrainingBtn');
            const submissionStatus = document.getElementById('submissionStatus');
            const progressFillTest = document.getElementById('progressFillTest');
            const activeChannelName = document.getElementById('activeChannelName');
            const channelTopic = document.getElementById('channelTopic');
            const onlineCount = document.getElementById('onlineCount');
            const statTickets = document.getElementById('statTickets');
            const statScore = document.getElementById('statScore');
            
            // Sidebar elements
            const serverHeader = document.getElementById('serverHeader');
            const serverDropdown = document.getElementById('serverDropdown');
            const serverInfoPanel = document.getElementById('serverInfoPanel');
            const channelsHeader = document.getElementById('channelsHeader');
            const channelsDropdown = document.getElementById('channelsDropdown');
            const channelsList = document.getElementById('channelsList');
            const voiceChannelsHeader = document.getElementById('voiceChannelsHeader');
            const voiceChannelsDropdown = document.getElementById('voiceChannelsDropdown');
            const voiceChannelsList = document.getElementById('voiceChannelsList');
            const userProfile = document.getElementById('userProfile');
            const userModal = document.getElementById('userModal');
            const userAvatar = document.getElementById('userAvatar');
            const userModalAvatar = document.getElementById('userModalAvatar');
            const userModalName = document.getElementById('userModalName');
            const userModalTag = document.getElementById('userModalTag');
            
            // Chat control buttons
            const pinMessagesBtn = document.getElementById('pinMessagesBtn');
            const membersListBtn = document.getElementById('membersListBtn');
            const searchBtn = document.getElementById('searchBtn');
            
            // Initialize the Discord interface
            function initializeDiscordInterface() {
                // Populate text channels
                textChannels.forEach(channel => {
                    const channelItem = document.createElement('div');
                    channelItem.className = `channel-item ${channel.id === 1 ? 'active' : ''} ${channel.unread ? 'unread' : ''}`;
                    channelItem.dataset.channelId = channel.id;
                    channelItem.dataset.channelName = channel.name;
                    channelItem.dataset.channelTopic = channel.topic;
                    
                    channelItem.innerHTML = `
                        <div class="channel-icon">
                            <i class="${channel.icon}"></i>
                        </div>
                        <div class="channel-name">${channel.name}</div>
                        ${channel.notifications > 0 ? `<div class="channel-notification">${channel.notifications}</div>` : ''}
                    `;
                    
                    channelItem.addEventListener('click', () => switchChannel(channel.id));
                    channelsList.appendChild(channelItem);
                });
                
                // Populate voice channels
                voiceChannels.forEach(channel => {
                    const channelItem = document.createElement('div');
                    channelItem.className = 'channel-item';
                    channelItem.dataset.channelId = channel.id;
                    
                    channelItem.innerHTML = `
                        <div class="channel-icon">
                            <i class="${channel.icon}"></i>
                        </div>
                        <div class="channel-name">${channel.name}</div>
                        <div class="channel-notification">${channel.users}</div>
                    `;
                    
                    voiceChannelsList.appendChild(channelItem);
                });
                
                // Toggle server info panel
                serverHeader.addEventListener('click', () => {
                    serverInfoPanel.classList.toggle('show');
                    serverDropdown.classList.toggle('open');
                });
                
                // Toggle text channels list
                channelsHeader.addEventListener('click', () => {
                    channelsList.style.display = channelsList.style.display === 'none' ? 'block' : 'none';
                    channelsDropdown.classList.toggle('open');
                });
                
                // Toggle voice channels list
                voiceChannelsHeader.addEventListener('click', () => {
                    voiceChannelsList.style.display = voiceChannelsList.style.display === 'none' ? 'block' : 'none';
                    voiceChannelsDropdown.classList.toggle('open');
                });
                
                // User profile modal
                userProfile.addEventListener('click', (e) => {
                    e.stopPropagation();
                    userModal.classList.toggle('active');
                });
                
                // Close modal when clicking outside
                document.addEventListener('click', (e) => {
                    if (!userModal.contains(e.target) && !userProfile.contains(e.target)) {
                        userModal.classList.remove('active');
                    }
                });
                
                // Chat control buttons
                pinMessagesBtn.addEventListener('click', () => {
                    showNotification("Pinned messages would open here in a real Discord client.");
                });
                
                membersListBtn.addEventListener('click', () => {
                    showNotification("Member list would open here in a real Discord client.");
                });
                
                searchBtn.addEventListener('click', () => {
                    showNotification("Search function would open here in a real Discord client.");
                });
                
                // Set initial channel info
                updateChannelInfo(1);
            }
            
            // Switch to a different channel
            function switchChannel(channelId) {
                // Update active channel in sidebar
                document.querySelectorAll('.channel-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`.channel-item[data-channel-id="${channelId}"]`).classList.add('active');
                
                // Update channel info in header
                const channel = textChannels.find(c => c.id === channelId);
                if (channel) {
                    updateChannelInfo(channelId);
                    
                    // If switching away from training-test during test, show warning
                    if (channelId !== 1 && testActive) {
                        showNotification("You're currently in a test. Please stay in #training-test to complete it.");
                    }
                }
            }
            
            // Update channel information in header
            function updateChannelInfo(channelId) {
                const channel = textChannels.find(c => c.id === channelId);
                if (channel) {
                    activeChannelName.textContent = channel.name;
                    channelTopic.textContent = channel.topic;
                    
                    // Update online count based on channel
                    let count = 3; // Base count for training-test
                    if (channelId === 2) count = 8; // how-to-join-roster
                    else if (channelId === 3) count = 24; // general
                    else if (channelId === 5) count = 6; // mod-chat
                    
                    onlineCount.textContent = count;
                }
            }
            
            // Show notification
            function showNotification(message) {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = 'message';
                notification.style.animation = 'messageAppear 0.3s ease';
                
                notification.innerHTML = `
                    <div class="message-avatar" style="background-color: #faa81a;">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <div class="message-username">System</div>
                            <div class="message-timestamp">Just now</div>
                        </div>
                        <div class="message-text">${message}</div>
                    </div>
                `;
                
                testMessagesContainer.appendChild(notification);
                testMessagesContainer.scrollTop = testMessagesContainer.scrollHeight;
            }
            
            // Back to training button
            backToTrainingBtn.addEventListener('click', function() {
                document.getElementById('testPage').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'block';
                resetTest();
            });
            
            testBackToTrainingBtn.addEventListener('click', function() {
                document.getElementById('testPage').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'block';
                resetTest();
            });
            
            // Auto-resize textarea
            testMessageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // Send message on Enter (without Shift)
            testMessageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendTestMessage();
                }
            });
            
            // Send message on button click
            testSendButton.addEventListener('click', sendTestMessage);
            
            // Retake test button
            testReviewTestBtn.addEventListener('click', function() {
                resetTest();
                testCompleteScreen.classList.remove('active');
                testChatArea.style.display = 'flex';
                setTimeout(() => {
                    startTest();
                }, 500);
            });
            
            // Start test with username button
            document.getElementById('startTestWithUsername').addEventListener('click', function() {
                const discordUsername = document.getElementById('discordUsername').value.trim();
                if (!discordUsername) {
                    alert('Please enter your Discord username to continue.');
                    return;
                }
                
                // Store the username
                userDiscordUsername = discordUsername;
                
                // Update the display
                document.getElementById('usernameDisplay').textContent = discordUsername.split('#')[0];
                document.getElementById('userModalName').textContent = discordUsername.split('#')[0];
                document.getElementById('userModalTag').textContent = discordUsername;
                
                // Set avatar initials
                const initials = discordUsername.split('#')[0].charAt(0).toUpperCase();
                userAvatar.textContent = initials;
                userModalAvatar.textContent = initials;
                
                // Hide modal and show test page
                document.getElementById('usernameModal').classList.remove('active');
                document.getElementById('mainContainer').style.display = 'none';
                document.getElementById('testPage').style.display = 'block';
                
                // Initialize Discord interface
                initializeDiscordInterface();
                
                // Start the test
                setTimeout(() => {
                    startTest();
                }, 1000);
            });
            
            // Function to start the test
            function startTest() {
                testActive = true;
                testCurrentQuestion = 0;
                testScore = 0;
                userAnswers = [];
                correctAnswers = [];
                updateTestScore();
                updateTestStatus();
                updateProgressBar();
                
                // Clear previous messages (keep only initial bot messages)
                const initialMessages = testMessagesContainer.querySelectorAll('.message');
                for (let i = 2; i < initialMessages.length; i++) {
                    initialMessages[i].remove();
                }
                
                // Update user stats
                statTickets.textContent = Math.floor(Math.random() * 5) + 1;
                statScore.textContent = "0%";
                
                // Start with first question
                setTimeout(() => {
                    showNextTestQuestion();
                }, 2000);
            }
            
            // Function to reset the test
            function resetTest() {
                testActive = false;
                testCurrentQuestion = 0;
                testScore = 0;
                userAnswers = [];
                correctAnswers = [];
                updateTestScore();
                updateTestStatus();
                updateProgressBar();
                
                // Clear input
                testMessageInput.value = '';
                testMessageInput.style.height = 'auto';
                testMessageInput.disabled = true;
                testSendButton.disabled = true;
            }
            
            // Function to show the next question from the bot
            function showNextTestQuestion() {
                if (testCurrentQuestion >= testTotalQuestions) {
                    endTest();
                    return;
                }
                
                // Show typing indicator
                testTypingIndicator.style.display = 'flex';
                
                // Wait 1-2 seconds to simulate typing
                setTimeout(() => {
                    testTypingIndicator.style.display = 'none';
                    
                    // Add the user's message
                    const question = testQuestions[testCurrentQuestion];
                    addTestMessage(question.user, question.userMessage, question.avatarColor, false);
                    
                    // Enable input for user response
                    testMessageInput.disabled = false;
                    testSendButton.disabled = false;
                    testMessageInput.focus();
                    
                    // Update status
                    updateTestStatus();
                    updateProgressBar();
                }, 1500 + Math.random() * 1000);
            }
            
            // Function to send user's message
            function sendTestMessage() {
                const userMessage = testMessageInput.value.trim();
                
                if (!userMessage || !testActive) return;
                
                // Add user's message to chat
                addTestMessage("You", userMessage, "#5865f2", true);
                
                // Store the answer
                userAnswers.push(userMessage);
                
                // Clear input
                testMessageInput.value = '';
                testMessageInput.style.height = 'auto';
                
                // Check if answer is correct
                const isCorrect = checkTestAnswer(userMessage);
                correctAnswers.push(isCorrect);
                
                // Disable input while bot "types"
                testMessageInput.disabled = true;
                testSendButton.disabled = true;
                
                // Move to next question after delay
                setTimeout(() => {
                    testCurrentQuestion++;
                    showNextTestQuestion();
                }, 1000);
            }
            
            // Enhanced function to check if answer is correct with comprehensive keyword matching
            function checkTestAnswer(userAnswer) {
                const question = testQuestions[testCurrentQuestion];
                const userAnswerLower = userAnswer.toLowerCase();
                
                // Count matching keywords
                let matchCount = 0;
                for (let keyword of question.correctKeywords) {
                    if (userAnswerLower.includes(keyword.toLowerCase())) {
                        matchCount++;
                    }
                }
                
                // Check if we have enough matches
                const isCorrect = matchCount >= question.requiredMatches;
                
                // Update score if correct
                if (isCorrect) {
                    testScore++;
                    updateTestScore();
                    updateProgressBar();
                    
                    // Add correct badge to last user message
                    const lastMessage = testMessagesContainer.lastElementChild;
                    if (lastMessage && lastMessage.classList.contains('message')) {
                        lastMessage.classList.add('correct');
                        
                        const messageText = lastMessage.querySelector('.message-text');
                        if (messageText) {
                            const badge = document.createElement('span');
                            badge.className = 'feedback-badge correct-badge';
                            badge.textContent = 'Correct';
                            messageText.appendChild(badge);
                            
                            // Add explanation tooltip
                            const tooltip = document.createElement('div');
                            tooltip.className = 'correction-note';
                            tooltip.style.marginTop = '10px';
                            tooltip.style.fontSize = '0.85rem';
                            tooltip.innerHTML = `<strong>Note:</strong> ${question.explanation}`;
                            messageText.appendChild(tooltip);
                        }
                    }
                } else {
                    // Add incorrect badge to last user message
                    const lastMessage = testMessagesContainer.lastElementChild;
                    if (lastMessage && lastMessage.classList.contains('message')) {
                        lastMessage.classList.add('incorrect');
                        
                        const messageText = lastMessage.querySelector('.message-text');
                        if (messageText) {
                            const badge = document.createElement('span');
                            badge.className = 'feedback-badge incorrect-badge';
                            badge.textContent = 'Incorrect';
                            messageText.appendChild(badge);
                            
                            // Add explanation tooltip
                            const tooltip = document.createElement('div');
                            tooltip.className = 'correction-note';
                            tooltip.style.marginTop = '10px';
                            tooltip.style.fontSize = '0.85rem';
                            tooltip.innerHTML = `<strong>Expected:</strong> ${question.explanation}<br><strong>Matched Keywords:</strong> ${matchCount}/${question.requiredMatches}`;
                            messageText.appendChild(tooltip);
                        }
                    }
                }
                
                return isCorrect;
            }
            
            // Function to add a message to the chat
            function addTestMessage(username, text, avatarColor, isUser = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                
                // Get current time for timestamp
                const now = new Date();
                const timeString = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
                
                // Create avatar initials
                let avatarInitials = username.charAt(0).toUpperCase();
                if (username === "Nicks Cold") avatarInitials = "NC";
                if (username === "You") avatarInitials = userDiscordUsername.split('#')[0].charAt(0).toUpperCase();
                
                messageDiv.innerHTML = `
                    <div class="message-avatar" style="background-color: ${avatarColor};">${avatarInitials}</div>
                    <div class="message-content">
                        <div class="message-header">
                            <div class="message-username">${username}</div>
                            ${username === "Void Bot" ? '<span class="message-bot-tag">BOT</span>' : ''}
                            <div class="message-timestamp">Today at ${timeString}</div>
                        </div>
                        <div class="message-text">${text}</div>
                    </div>
                `;
                
                testMessagesContainer.appendChild(messageDiv);
                
                // Scroll to bottom
                testMessagesContainer.scrollTop = testMessagesContainer.scrollHeight;
            }
            
            // Function to update score display
            function updateTestScore() {
                testScoreValue.textContent = testScore;
                updateTestStatus();
                
                // Update user stats
                const percentage = Math.round((testScore / testTotalQuestions) * 100);
                statScore.textContent = `${percentage}%`;
            }
            
            // Function to update progress bar
            function updateProgressBar() {
                const percentage = (testCurrentQuestion / testTotalQuestions) * 100;
                progressFillTest.style.width = `${percentage}%`;
            }
            
            // Function to update status indicator
            function updateTestStatus() {
                const percentage = (testCurrentQuestion / testTotalQuestions) * 100;
                
                if (testCurrentQuestion >= testTotalQuestions) {
                    testStatusText.textContent = "Test Complete";
                    testStatusDot.style.backgroundColor = "#3ba55c";
                } else {
                    testStatusText.textContent = `Question ${testCurrentQuestion + 1} of ${testTotalQuestions}`;
                    
                    // Change dot color based on progress
                    if (percentage < 33) {
                        testStatusDot.style.backgroundColor = "#ed4245";
                    } else if (percentage < 66) {
                        testStatusDot.style.backgroundColor = "#faa81a";
                    } else {
                        testStatusDot.style.backgroundColor = "#3ba55c";
                    }
                }
            }
            
            // Function to send results via email
            function sendResultsToEmail() {
                // Create question breakdown text
                let questionBreakdown = "";
                for (let i = 0; i < testTotalQuestions; i++) {
                    const question = testQuestions[i];
                    const userAnswer = userAnswers[i] || "No answer";
                    const isCorrect = correctAnswers[i] ? "✓ CORRECT" : "✗ INCORRECT";
                    
                    questionBreakdown += `${i+1}. ${question.user}: "${question.userMessage}"\n`;
                    questionBreakdown += `   Trainee Answer: "${userAnswer}"\n`;
                    questionBreakdown += `   ${isCorrect}\n\n`;
                }
                
                // Get current date
                const now = new Date();
                const testDate = now.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Calculate pass/fail
                const passingScore = testTotalQuestions - 2; // Need at least 6 out of 8
                const passed = testScore >= passingScore;
                const passFail = passed ? "PASS" : "FAIL";
                
                // Populate form fields
                document.getElementById('formDiscordUsername').value = userDiscordUsername;
                document.getElementById('formTestDate').value = testDate;
                document.getElementById('formFinalScore').value = `${testScore}/${testTotalQuestions}`;
                document.getElementById('formPassFail').value = passFail;
                document.getElementById('formQuestionBreakdown').value = questionBreakdown;
                document.getElementById('formTotalQuestions').value = testTotalQuestions;
                
                // Submit the form
                document.getElementById('resultsForm').submit();
                
                return true;
            }
            
            // Function to end the test and show results
            function endTest() {
                testActive = false;
                
                // Add final message
                setTimeout(() => {
                    addTestMessage("Void Bot", "Test complete! Your responses have been evaluated. Check your score in the sidebar.", "#5865f2", false);
                    
                    // Show test complete screen after delay
                    setTimeout(() => {
                        testChatArea.style.display = 'none';
                        testCompleteScreen.classList.add('active');
                        
                        // Calculate result
                        const passingScore = testTotalQuestions - 2; // Need to get at least 6 out of 8
                        const passed = testScore >= passingScore;
                        
                        // Update result screen
                        testResultScore.textContent = `Score: ${testScore}/${testTotalQuestions}`;
                        
                        if (passed) {
                            testResultTitle.textContent = "Test Passed!";
                            testResultMessage.textContent = `Congratulations! You passed the mod certification test with a score of ${testScore}/${testTotalQuestions}. You demonstrated knowledge of proper ticket handling procedures.`;
                            testResultIcon.innerHTML = '<i class="fas fa-trophy"></i>';
                            testResultIcon.className = "test-result-icon test-result-pass";
                        } else {
                            testResultTitle.textContent = "Test Failed";
                            testResultMessage.textContent = `You scored ${testScore}/${testTotalQuestions}. You need at least ${passingScore} correct answers to pass. Review the training material and try again.`;
                            testResultIcon.innerHTML = '<i class="fas fa-times-circle"></i>';
                            testResultIcon.className = "test-result-icon test-result-fail";
                        }
                        
                        // Send results to email
                        setTimeout(() => {
                            submissionStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting your results to Void Esports staff...';
                            
                            setTimeout(() => {
                                try {
                                    const sent = sendResultsToEmail();
                                    if (sent) {
                                        submissionStatus.innerHTML = '<i class="fas fa-check-circle"></i> Results submitted successfully! The Void Esports staff will review your performance.';
                                        submissionStatus.className = "submission-status submission-success";
                                    } else {
                                        submissionStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> Results submission failed. Please try again.';
                                        submissionStatus.className = "submission-status submission-error";
                                    }
                                } catch (error) {
                                    submissionStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> Error submitting results. Please contact staff.';
                                    submissionStatus.className = "submission-status submission-error";
                                }
                            }, 1500);
                        }, 1000);
                    }, 1500);
                }, 1000);
            }
        });
    </script>
</body>
</html>
